<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–π–ª–∏ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç - –ö–ª–∏–º–∞—Ç–∏—Ü–∏ –ï–û–û–î</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }

        /* Header */
        .header {
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .top-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #0891b2;
            font-size: 24px;
            font-weight: bold;
        }

        .logo i {
            font-size: 36px;
        }

        .nav-icons {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-icons a {
            color: #333;
            font-size: 20px;
            position: relative;
            transition: transform 0.2s;
        }

        .nav-icons a:hover {
            transform: scale(1.15);
            color: #0891b2;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }

        /* Breadcrumbs */
        .breadcrumbs {
            padding: 15px 60px;
            background: #fff;
            border-top: 1px solid #e5e7eb;
        }

        .breadcrumbs a {
            color: #0891b2;
            text-decoration: none;
        }

        .breadcrumbs a:hover {
            text-decoration: underline;
        }

        .breadcrumbs span {
            color: #666;
            margin: 0 8px;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 60px;
        }

        /* Product Section */
        .product-section {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }

        .product-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
        }

        /* Product Gallery */
        .product-gallery {
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .main-image {
            width: 100%;
            height: 500px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .energy-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
        }

        .thumbnail-gallery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .thumbnail {
            height: 100px;
            background: #f5f5f5;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .thumbnail:hover {
            border-color: #0891b2;
        }

        .thumbnail.active {
            border-color: #0891b2;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Product Info */
        .product-info h1 {
            font-size: 2.2em;
            color: #333;
            margin-bottom: 10px;
        }

        .product-brand {
            color: #0891b2;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 20px;
            display: block;
        }

        .product-price {
            font-size: 3em;
            color: #0891b2;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .availability {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .availability.out-of-stock {
            background: #ef4444;
        }

        /* Specs */
        .specs-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .specs-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .spec-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spec-item i {
            color: #0891b2;
            font-size: 18px;
            width: 25px;
        }

        .spec-label {
            color: #666;
            font-weight: 500;
        }

        .spec-value {
            color: #333;
            font-weight: 600;
            margin-left: auto;
        }

        /* Services Section */
        .services-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .services-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .service-option {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .service-option:hover {
            border-color: #0891b2;
            transform: translateX(5px);
        }

        .service-option.selected {
            border-color: #0891b2;
            background: #f0f9ff;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
        }

        .service-option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .service-info {
            flex: 1;
            margin-left: 15px;
        }

        .service-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .service-description {
            font-size: 14px;
            color: #666;
        }

        .service-price {
            font-size: 1.3em;
            font-weight: bold;
            color: #0891b2;
        }

        /* Quantity Selector */
        .quantity-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            padding: 10px 20px;
            border-radius: 10px;
        }

        .quantity-btn {
            background: #0891b2;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .quantity-btn:hover {
            background: #0e7490;
        }

        .quantity-input {
            width: 60px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border: none;
            background: transparent;
        }

        /* Price Summary */
        .price-summary {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .price-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        #servicesRow {
            background: #f0f9ff;
            padding: 10px;
            margin: -10px -10px 5px -10px;
            border-radius: 8px;
        }

        #servicesRow span {
            color: #0891b2;
            font-weight: 600;
        }

        .price-row.total {
            font-size: 1.5em;
            font-weight: bold;
            color: #0891b2;
        }

        .price-row.total .summary-value {
            transition: all 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes priceChange {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
                color: #10b981;
            }
            100% {
                transform: scale(1);
            }
        }

        /* Add to Cart Button */
        .add-to-cart-btn {
            width: 100%;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            color: white;
            padding: 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .add-to-cart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(8, 145, 178, 0.4);
        }

        /* Description */
        .description-section {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e5e7eb;
        }

        .description-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .description-section p {
            color: #666;
            line-height: 1.8;
            font-size: 16px;
        }

        .features-list {
            list-style: none;
            margin-top: 20px;
        }

        .features-list li {
            padding: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .features-list li i {
            color: #10b981;
            font-size: 18px;
        }

        /* Related Products */
        .related-section {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .related-section h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .related-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .related-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-color: #0891b2;
        }

        .related-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .related-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .related-info {
            padding: 20px;
        }

        .related-brand {
            color: #0891b2;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .related-name {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .related-price {
            font-size: 1.5em;
            color: #0891b2;
            font-weight: bold;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 100px;
            color: #666;
        }

        .loading i {
            font-size: 48px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 968px) {
            .container {
                padding: 20px;
            }

            .product-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .product-gallery {
                position: static;
            }

            .specs-grid {
                grid-template-columns: 1fr;
            }

            .top-bar, .breadcrumbs {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>

<!-- Header -->
<div class="header">
    <div class="top-bar">
        <a href="index.html" class="logo">
            <i class="fas fa-wind"></i>
            <span>–ö–ª–∏–º–∞—Ç–∏—Ü–∏ –ï–û–û–î</span>
        </a>

        <div class="nav-icons">
            <a href="login.html" title="–í—Ö–æ–¥"><i class="fas fa-user"></i></a>
            <a href="#" title="–õ—é–±–∏–º–∏"><i class="fas fa-heart"></i></a>
            <a href="cart.html" title="–ö–æ–ª–∏—á–∫–∞">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge" id="cartCount">0</span>
            </a>
        </div>
    </div>

    <div class="breadcrumbs">
        <a href="index.html">–ù–∞—á–∞–ª–æ</a>
        <span>/</span>
        <a href="products.html">–ö–∞—Ç–∞–ª–æ–≥</a>
        <span>/</span>
        <span id="breadcrumbProduct">–ü—Ä–æ–¥—É–∫—Ç</span>
    </div>
</div>

<!-- Loading -->
<div id="loading" class="loading">
    <i class="fas fa-spinner"></i>
    <p>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç...</p>
</div>

<!-- Main Container -->
<div class="container" id="mainContent" style="display: none;">
    
    <!-- Product Section -->
    <div class="product-section">
        <div class="product-layout">
            
            <!-- Product Gallery -->
            <div class="product-gallery">
                <div class="main-image" id="mainImage">
                    <img src="" alt="" id="mainImageImg">
                    <div class="energy-badge" id="energyBadge">A+++</div>
                </div>
                <div class="thumbnail-gallery" id="thumbnailGallery">
                    <!-- Thumbnails will be inserted here -->
                </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
                <span class="product-brand" id="productBrand">–ú–∞—Ä–∫–∞</span>
                <h1 id="productName">–ò–º–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç</h1>
                
                <div class="availability" id="availability">
                    <i class="fas fa-check-circle"></i> –ù–∞ —Å–∫–ª–∞–¥
                </div>

                <div class="product-price" id="productPrice">0.00 –ª–≤</div>

                <!-- Specifications -->
                <div class="specs-section">
                    <h3><i class="fas fa-info-circle"></i> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
                    <div class="specs-grid" id="specsGrid">
                        <!-- Specs will be inserted here -->
                    </div>
                </div>

                <!-- Services -->
                <div class="services-section">
                    <h3><i class="fas fa-tools"></i> –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —É—Å–ª—É–≥–∏</h3>
                    <p style="color: #999; font-size: 13px; margin-bottom: 15px;">
                        <i class="fas fa-info-circle"></i> 
                        –ú–æ–Ω—Ç–∞–∂, —Ä–µ–º–æ–Ω—Ç –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞. –î–æ—Å—Ç–∞–≤–∫–∞—Ç–∞ —Å–µ –∏–∑–±–∏—Ä–∞ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞.
                    </p>
                    <div id="servicesContainer"></div>
                </div>

                <!-- Quantity -->
                <div class="quantity-section">
                    <label style="font-weight: 600; color: #333;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <div class="quantity-selector">
                        <button class="quantity-btn" onclick="changeQuantity(-1)">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" class="quantity-input" id="quantity" value="1" min="1" readonly>
                        <button class="quantity-btn" onclick="changeQuantity(1)">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <!-- Price Summary -->
                <div class="price-summary">
                    <div class="price-row">
                        <span>–¶–µ–Ω–∞ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç:</span>
                        <span id="productPriceCalc">0.00 –ª–≤</span>
                    </div>
                    <div class="price-row" id="servicesRow" style="display: none;">
                        <span>–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —É—Å–ª—É–≥–∏:</span>
                        <span id="servicesPriceCalc">0.00 –ª–≤</span>
                    </div>
                    <div class="price-row total">
                        <span>–û–±—â–∞ —Ü–µ–Ω–∞:</span>
                        <span id="totalPrice">0.00 –ª–≤</span>
                    </div>
                </div>

                <!-- Add to Cart -->
                <button class="add-to-cart-btn" onclick="addToCart()">
                    <i class="fas fa-shopping-cart"></i>
                    –î–æ–±–∞–≤–∏ –≤ –∫–æ–ª–∏—á–∫–∞
                </button>

                <!-- Description -->
                <div class="description-section">
                    <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p id="productDescription"></p>
                    <ul class="features-list" id="featuresList">
                        <!-- Features will be inserted here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="related-section" id="relatedSection" style="display: none;">
        <h2>–ü–æ–¥–æ–±–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</h2>
        <div class="related-grid" id="relatedGrid">
            <!-- Related products will be inserted here -->
        </div>
    </div>

</div>

<!-- Cart Manager Library -->
<script src="assets/js/cart-manager.js"></script>

<script>
    const API_URL = 'http://localhost/Diplomna/api';
    let currentProduct = null;
    let selectedServices = [];
    let availableServices = [];

    // Get product ID from URL
    function getProductId() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }

    // Load product on page load
    window.addEventListener('DOMContentLoaded', () => {
        const productId = getProductId();
        
        if (!productId) {
            alert('–ù—è–º–∞ –∏–∑–±—Ä–∞–Ω –ø—Ä–æ–¥—É–∫—Ç');
            window.location.href = 'products.html';
            return;
        }

        loadProduct(productId);
        loadServices();
    });

    // Load product details
    async function loadProduct(productId) {
        try {
            const response = await fetch(`${API_URL}/products/get_by_id.php?id=${productId}`);
            const result = await response.json();

            console.log('Product data:', result);

            if (result.success) {
                currentProduct = result.product;
                displayProduct(currentProduct);
            } else {
                alert('–ü—Ä–æ–¥—É–∫—Ç—ä—Ç –Ω–µ –µ –Ω–∞–º–µ—Ä–µ–Ω');
                window.location.href = 'products.html';
            }

        } catch (error) {
            console.error('Error:', error);
            alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞');
        }
    }

    // Display product
    function displayProduct(product) {
        // Hide loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';

        // Update page title and breadcrumb
        document.title = `${product.model_name} - –ö–ª–∏–º–∞—Ç–∏—Ü–∏ –ï–û–û–î`;
        document.getElementById('breadcrumbProduct').textContent = product.model_name;

        // Brand and name
        document.getElementById('productBrand').textContent = product.brand_name;
        document.getElementById('productName').textContent = product.model_name;

        // Price
        const price = parseFloat(product.price);
        document.getElementById('productPrice').textContent = `${price.toFixed(2)} –ª–≤`;

        // Availability
        const availabilityEl = document.getElementById('availability');
        if (product.stock_quantity > 0) {
            availabilityEl.innerHTML = '<i class="fas fa-check-circle"></i> –ù–∞ —Å–∫–ª–∞–¥';
            availabilityEl.className = 'availability';
        } else {
            availabilityEl.innerHTML = '<i class="fas fa-times-circle"></i> –ò–∑—á–µ—Ä–ø–∞–Ω';
            availabilityEl.className = 'availability out-of-stock';
        }

        // Energy badge
        document.getElementById('energyBadge').textContent = product.energy_class;

        // Main image
        const mainImg = document.getElementById('mainImageImg');
        mainImg.src = product.main_image_url || `https://via.placeholder.com/600x500?text=${encodeURIComponent(product.model_name)}`;
        mainImg.alt = product.model_name;

        // Gallery
        displayGallery(product.images || []);

        // Specifications
        displaySpecs(product);

        // Description
        document.getElementById('productDescription').textContent = product.description || '–ù—è–º–∞ –æ–ø–∏—Å–∞–Ω–∏–µ';

        // Features
        if (product.features) {
            const features = product.features.split(',');
            const featuresList = document.getElementById('featuresList');
            featuresList.innerHTML = features.map(f => `
                <li><i class="fas fa-check-circle"></i> ${f.trim()}</li>
            `).join('');
        }

        // Related products
        if (product.related_products && product.related_products.length > 0) {
            displayRelatedProducts(product.related_products);
        }

        // Update price calculator
        updatePriceCalculator();
    }

    // Display gallery
    function displayGallery(images) {
        const gallery = document.getElementById('thumbnailGallery');
        
        if (images.length === 0) {
            gallery.style.display = 'none';
            return;
        }

        gallery.innerHTML = images.map((img, index) => `
            <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="changeMainImage('${img.image_url}', ${index})">
                <img src="${img.image_url}" alt="Image ${index + 1}"
                     onerror="this.src='https://via.placeholder.com/100?text=Image'">
            </div>
        `).join('');
    }

    // Change main image
    function changeMainImage(imageUrl, index) {
        document.getElementById('mainImageImg').src = imageUrl;
        
        // Update active thumbnail
        document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
            thumb.classList.toggle('active', i === index);
        });
    }

    // Display specifications
    function displaySpecs(product) {
        const specs = [
            { icon: 'bolt', label: 'BTU –º–æ—â–Ω–æ—Å—Ç', value: `${product.btu_power} BTU` },
            { icon: 'leaf', label: '–ï–Ω–µ—Ä–≥–∏–µ–Ω –∫–ª–∞—Å', value: product.energy_class },
            { icon: 'shield-alt', label: '–ì–∞—Ä–∞–Ω—Ü–∏—è', value: `${product.warranty_months} –º–µ—Å–µ—Ü–∞` },
            { icon: 'box', label: '–ù–∞ —Å–∫–ª–∞–¥', value: `${product.stock_quantity} –±—Ä.` }
        ];

        const specsGrid = document.getElementById('specsGrid');
        specsGrid.innerHTML = specs.map(spec => `
            <div class="spec-item">
                <i class="fas fa-${spec.icon}"></i>
                <span class="spec-label">${spec.label}:</span>
                <span class="spec-value">${spec.value}</span>
            </div>
        `).join('');
    }

    // Load services
    async function loadServices() {
        try {
            const response = await fetch(`${API_URL}/services/get_all.php`);
            const result = await response.json();

            console.log('Services API response:', result); // Debug

            if (result.success && result.services && result.services.length > 0) {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ —Å–∞–º–æ —É—Å–ª—É–≥–∏ –ë–ï–ó –¥–æ—Å—Ç–∞–≤–∫–∞ - –¥–æ—Å—Ç–∞–≤–∫–∞—Ç–∞ —Å–µ –∏–∑–±–∏—Ä–∞ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞
                availableServices = result.services.filter(s => {
                    const isActive = s.is_active === 1 || s.is_active === '1' || !('is_active' in s);
                    const isNotDelivery = s.service_type !== 'delivery';
                    return isActive && isNotDelivery;
                });
                
                console.log('Filtered services:', availableServices); // Debug
                displayServices(availableServices);
            } else {
                console.log('No services returned from API'); // Debug
                // Show default services if API fails
                availableServices = [
                    { service_id: 1, service_name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞', description: '3-5 —Ä–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏', price: 30 },
                    { service_id: 3, service_name: '–û—Å–Ω–æ–≤–µ–Ω –º–æ–Ω—Ç–∞–∂', description: '–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –º–æ–Ω—Ç–∞–∂', price: 150 }
                ];
                displayServices(availableServices);
            }

        } catch (error) {
            console.error('Error loading services:', error);
            // Show default services if API fails
            availableServices = [
                { service_id: 1, service_name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞', description: '3-5 —Ä–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏', price: 30 },
                { service_id: 3, service_name: '–û—Å–Ω–æ–≤–µ–Ω –º–æ–Ω—Ç–∞–∂', description: '–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω –º–æ–Ω—Ç–∞–∂', price: 150 }
            ];
            displayServices(availableServices);
        }
    }

    // Display services
    function displayServices(services) {
        const container = document.getElementById('servicesContainer');
        
        console.log('Displaying services:', services);
        
        if (!services || services.length === 0) {
            container.innerHTML = '<p style="color: #999; text-align: center;">–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–∏ —É—Å–ª—É–≥–∏ –≤ –º–æ–º–µ–Ω—Ç–∞</p>';
            return;
        }

        container.innerHTML = services.map(service => `
            <div class="service-option" id="service_div_${service.service_id}" onclick="toggleService(${service.service_id}, event)">
                <input type="checkbox" id="service_${service.service_id}" onclick="event.stopPropagation(); toggleService(${service.service_id}, event)">
                <div class="service-info">
                    <div class="service-name">${service.service_name}</div>
                    <div class="service-description">${service.description || ''}</div>
                </div>
                <div class="service-price">+${parseFloat(service.price).toFixed(2)} –ª–≤</div>
            </div>
        `).join('');
    }

    // Toggle service selection
    function toggleService(serviceId, event) {
        const checkbox = document.getElementById(`service_${serviceId}`);
        const serviceDiv = document.getElementById(`service_div_${serviceId}`);

        // –ê–∫–æ –µ –∫–ª–∏–∫–Ω–∞—Ç–æ –¥–∏—Ä–µ–∫—Ç–Ω–æ –Ω–∞ checkbox - –Ω–µ –≥–æ toggle-–≤–∞–º–µ –Ω–∏–µ,
        // —Ç–æ–π –≤–µ—á–µ –µ —Å–º–µ–Ω–µ–Ω –æ—Ç –±—Ä–∞—É–∑—ä—Ä–∞. –°–∞–º–æ —á–µ—Ç–µ–º –Ω–µ–≥–æ–≤–æ—Ç–æ —Ç–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ.
        // –ê–∫–æ –µ –∫–ª–∏–∫–Ω–∞—Ç–æ –Ω–∞ div - —Ç–æ–≥–∞–≤–∞ –Ω–∏–µ —Å–º–µ–Ω—è–º–µ checkbox-–∞.
        if (event && event.target !== checkbox) {
            checkbox.checked = !checkbox.checked;
        }

        // –û–±–Ω–æ–≤—è–≤–∞–º–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è—Ç–∞ –∏ selectedServices —Å–ø—Ä—è–º–æ —Ç–µ–∫—É—â–æ—Ç–æ checked
        if (checkbox.checked) {
            serviceDiv.classList.add('selected');
            const service = availableServices.find(s => s.service_id === serviceId);
            if (service && !selectedServices.find(s => s.service_id === serviceId)) {
                selectedServices.push(service);
                console.log('‚úÖ Service added:', service.service_name, '+' + service.price + ' –ª–≤');
            }
        } else {
            serviceDiv.classList.remove('selected');
            selectedServices = selectedServices.filter(s => s.service_id !== serviceId);
            console.log('‚ùå Service removed:', serviceId);
        }

        updatePriceCalculator();

        // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞ —Ü–µ–Ω–∞—Ç–∞
        const totalPriceEl = document.getElementById('totalPrice');
        totalPriceEl.style.transform = 'scale(1.1)';
        totalPriceEl.style.color = '#10b981';
        setTimeout(() => {
            totalPriceEl.style.transform = 'scale(1)';
            totalPriceEl.style.color = '#0891b2';
        }, 200);
    }

    // Change quantity
    function changeQuantity(change) {
        const input = document.getElementById('quantity');
        let value = parseInt(input.value) + change;
        
        if (value < 1) value = 1;
        if (currentProduct && value > currentProduct.stock_quantity) {
            value = currentProduct.stock_quantity;
        }

        input.value = value;
        updatePriceCalculator();
    }

    // Update price calculator
    function updatePriceCalculator() {
        if (!currentProduct) return;

        const quantity = parseInt(document.getElementById('quantity').value);
        const productPrice = parseFloat(currentProduct.price) * quantity;
        
        let servicesPrice = 0;
        let serviceDetails = [];

        selectedServices.forEach(service => {
            const price = parseFloat(service.price);
            const isDelivery = service.service_type === 'delivery';
            
            if (isDelivery) {
                // –î–æ—Å—Ç–∞–≤–∫–∞ - –µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞, –Ω–µ —Å–µ –º–Ω–æ–∂–∏
                servicesPrice += price;
                serviceDetails.push(`${service.service_name}: ${price.toFixed(2)} –ª–≤ (–µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞)`);
            } else {
                // –ú–æ–Ω—Ç–∞–∂, —Ä–µ–º–æ–Ω—Ç, –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ - √ó –±—Ä–æ–π –∫–ª–∏–º–∞—Ç–∏—Ü–∏
                servicesPrice += price * quantity;
                serviceDetails.push(`${service.service_name}: ${price.toFixed(2)} √ó ${quantity} = ${(price * quantity).toFixed(2)} –ª–≤`);
            }
        });

        const totalPrice = productPrice + servicesPrice;

        console.log('üí∞ Price calculation:', {
            productPrice: `${parseFloat(currentProduct.price).toFixed(2)} √ó ${quantity} = ${productPrice.toFixed(2)}`,
            services: serviceDetails,
            servicesTotal: servicesPrice.toFixed(2),
            totalPrice: totalPrice.toFixed(2)
        });

        // –û–±–Ω–æ–≤—è–≤–∞–º–µ display
        document.getElementById('productPriceCalc').textContent = `${productPrice.toFixed(2)} –ª–≤`;
        document.getElementById('servicesPriceCalc').textContent = `${servicesPrice.toFixed(2)} –ª–≤`;
        document.getElementById('totalPrice').textContent = `${totalPrice.toFixed(2)} –ª–≤`;

        // –ü–æ–∫–∞–∑–≤–∞–º–µ/—Å–∫—Ä–∏–≤–∞–º–µ —Ä–µ–¥ –∑–∞ —É—Å–ª—É–≥–∏
        const servicesRow = document.getElementById('servicesRow');
        if (selectedServices.length > 0) {
            servicesRow.style.display = 'flex';
            servicesRow.style.animation = 'fadeIn 0.3s ease';
        } else {
            servicesRow.style.display = 'none';
        }

        // –û–±–Ω–æ–≤—è–≤–∞–º–µ tooltip —Å —Ä–∞–∑–±–∏–≤–∫–∞ (–ø–æ–∫–∞–∑–≤–∞ —Å–µ –≤ –±–µ–ª–µ–∂–∫–∞ –ø–æ–¥ —É—Å–ª—É–≥–∏—Ç–µ)
        updateServicesBreakdown(serviceDetails, quantity);
    }

    // –ü–æ–∫–∞–∑–≤–∞ —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ–¥ —É—Å–ª—É–≥–∏—Ç–µ
    function updateServicesBreakdown(serviceDetails, quantity) {
        let breakdown = document.getElementById('servicesBreakdown');
        
        if (!breakdown) {
            breakdown = document.createElement('div');
            breakdown.id = 'servicesBreakdown';
            breakdown.style.cssText = `
                margin-top: 10px;
                padding: 12px 15px;
                background: #f0f9ff;
                border-radius: 8px;
                font-size: 13px;
                color: #555;
                border-left: 3px solid #0891b2;
                animation: fadeIn 0.3s ease;
            `;
            document.getElementById('servicesRow').after(breakdown);
        }

        if (serviceDetails.length === 0) {
            breakdown.style.display = 'none';
            return;
        }

        breakdown.style.display = 'block';
        breakdown.innerHTML = `
            <strong style="color: #0891b2; display: block; margin-bottom: 6px;">
                <i class="fas fa-info-circle"></i> –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —É—Å–ª—É–≥–∏—Ç–µ:
            </strong>
            ${serviceDetails.map(detail => {
                const isOnetime = detail.includes('–µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞');
                return `
                    <div style="display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                        <i class="fas fa-${isOnetime ? 'truck' : 'tools'}" 
                           style="color: ${isOnetime ? '#10b981' : '#0891b2'}; width: 14px;"></i>
                        <span>${detail}</span>
                        ${!isOnetime ? `<span style="background: #dbeafe; color: #1d4ed8; padding: 1px 6px; border-radius: 10px; font-size: 11px;">√ó${quantity}</span>` : '<span style="background: #d1fae5; color: #065f46; padding: 1px 6px; border-radius: 10px; font-size: 11px;">–µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞</span>'}
                    </div>
                `;
            }).join('')}
        `;
    }

    // Add to cart
    function addToCart() {
        console.log('üõí addToCart called'); // Debug
        
        if (!currentProduct) {
            console.error('‚ùå No current product!'); // Debug
            alert('–ì—Ä–µ—à–∫–∞: –ü—Ä–æ–¥—É–∫—Ç—ä—Ç –Ω–µ –µ –∑–∞—Ä–µ–¥–µ–Ω');
            return;
        }

        const quantity = parseInt(document.getElementById('quantity').value);
        
        console.log('üì¶ Current product:', currentProduct); // Debug
        console.log('üî¢ Quantity:', quantity); // Debug
        console.log('üõ†Ô∏è Selected services:', selectedServices); // Debug
        console.log('üîß CartManager:', CartManager); // Debug

        // Add to cart using CartManager
        try {
            const result = CartManager.addProduct(currentProduct, quantity, selectedServices);
            console.log('‚úÖ Added to cart:', result); // Debug

            const totalPrice = parseFloat(document.getElementById('totalPrice').textContent);

            // Show success message with option to go to cart
            const goToCart = confirm(`‚úÖ –î–æ–±–∞–≤–µ–Ω–æ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞!\n\n${currentProduct.model_name}\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${quantity}\n–û–±—â–∞ —Ü–µ–Ω–∞: ${totalPrice.toFixed(2)} –ª–≤\n\n–ò—Å–∫–∞—Ç–µ –ª–∏ –¥–∞ –æ—Ç–∏–¥–µ—Ç–µ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞?`);
            
            if (goToCart) {
                window.location.href = 'cart.html';
            }
        } catch (error) {
            console.error('‚ùå Error adding to cart:', error); // Debug
            alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞: ' + error.message);
        }
    }

    // Display related products
    function displayRelatedProducts(products) {
        const section = document.getElementById('relatedSection');
        const grid = document.getElementById('relatedGrid');

        section.style.display = 'block';

        grid.innerHTML = products.map(product => `
            <a href="product-detail.html?id=${product.product_id}" class="related-card">
                <div class="related-image">
                    <img src="${product.main_image_url}" alt="${product.model_name}"
                         onerror="this.src='https://via.placeholder.com/250x200?text=${encodeURIComponent(product.model_name)}'">
                </div>
                <div class="related-info">
                    <div class="related-brand">${product.brand_name}</div>
                    <div class="related-name">${product.model_name}</div>
                    <div class="related-price">${parseFloat(product.price).toFixed(2)} –ª–≤</div>
                </div>
            </a>
        `).join('');
    }
</script>

</body>
</html>